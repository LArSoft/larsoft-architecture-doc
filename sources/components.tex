% \section{Logical view: components}
% \label{sec:Components}

%
% This is the merging of "component view" and "component interafctions"
% from J&M outline, following Saba's suggestion.
%
%

To provide the best solutions for LAr TPC simulation, reconstruction and
analysis of data, LArSoft interacts with other software aimed to
provide developers with tools commonly in use by the broader physics community,
standardize code development,
and allow for experiment-specific needs (\cref{fig:LArSoftRelations}).
\begin{figure}
	\centering
	\includegraphics[width=0.8\textwidth]{figures/LArSoftEnvironment}
	\caption{\label{fig:LArSoftRelations}
		Relationship of LArSoft with other software categories.
	}
\end{figure}

Physics developers typically rely on copious libraries providing general or physics-specific services
(\cref{fig:LArSoftRelations:Libraries}).
LArSoft already offers:
\begin{itemize}
	\item a framework, based on \ART~\cite{ART}, providing essential functionalities
		including an event data model, an event loop, workflow definition and control,
		plug-in of code, distribution and tracking of job configuration,
		serialization of the results, and more
	\item proxy-, web-based access to data bases via \libwda~\cite{libwda},
		or direct access to \PostgreSQL databases\footnote{%
		Experience has shown that direct database does not scale well with the number of accessing jobs.%
		}
	\item physics libraries, as CERN \CLHEP and \nutools~\cite{nutools}
	\item event generation packages: \GENIE~\cite{GENIE}, \CRY~\cite{CRY}, HEPEVT files
	\item GEANT4~\cite{GEANT}, the detector simulation library
	\item pattern recognition libraries, like \Pandora
	\item data analysis tools, like CERN \ROOT~\cite{ROOT}
	\item visualization aids, also with CERN \ROOT and \nutools
\end{itemize}
\begin{figure}
	% TODO align the two sides;
	% 
	% \newsavebox{\tempbox}
	% \sbox{\tempbox{\includegraphics{large figure}}}
	% \subfloat{\label{...}\usebox{\tempbox}}
	% \subfloat{\label{...}\vbox to \ht\tempbox{\vfil\includegraphics{small figure}\vfil}}
	% 
	\subfloat{
		\label{fig:LArSoftRelations:Libraries}
		\includegraphics[scale=0.04,trim=500 500 500 500]{figures/LArSoftAndLibraries}
	}
	\subfloat{
		\label{fig:LArSoftRelations:Experiments}
		\includegraphics[scale=0.04,trim=500 500 500 500]{figures/LArSoftAndExperiments}
	}
	\caption{\label{fig:LArSoftRelationsI}
		Relationship between LArSoft and \protect\subref{fig:LArSoftRelations:Libraries} third-party libraries and \protect\subref{fig:LArSoftRelations:Experiments} experiment-specific software.
	}
\end{figure}

LArSoft also needs to accommodate specific needs from the experiments.
Experiments directly contribute LArSoft content when it's suitable, that is,
of general utility and experiment-agnostic.
In the other cases, experiments interface to LArSoft though many channels
(\cref{fig:LArSoftRelations:Experiments}):
\begin{itemize}
	\item detector geometry is provided in GDML or ROOT format
	\item detector conditions can be learned via static configuration or from experiment databases
	\item detector data is acquired by special \ART modules or by standard \ART files (e.g., produced by \ARTDAQ) containing standard LArSoft data products
	\item specialized services and algorithms can be plugged in using the \ART framework
	\item job configuration, controlling the data to be processed and the sequence of actions to perform,
		is specified in \FHiCL language
	\item workflows are defined by the experiment, typically by using custom scripts that include the execution of LArSoft main program
\end{itemize}
\begin{figure}
	\centering\includegraphics[scale=0.04]{figures/LArSoftAndDevelopment}
	\caption{\label{fig:LArSoftRelations:Development}
		Relationship between LArSoft and development software categories.
	}
\end{figure}

LArSoft has a large number of interdependent components,
and provides the users tools to facilitate code development (\cref{fig:LArSoftRelations:Development}).
LArSoft code is organized in repositories that can be compiled when needed.
A building system ensuring builds consistent among all supported platforms is employed.
The \UPS~\cite{UPS} distribution system ensures that the same consistency is preserved at run time.
Infrastructure for automatic execution of user tests is also provided,
together with a growing number of tests exercising parts of LArSoft tools.



